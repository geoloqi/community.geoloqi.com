<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-ca">
<head>
   <title>using iOS SDK with API call requiring access token (OAuth) - Geoloqi Community</title>
<link rel="stylesheet" type="text/css" href="/themes/geoloqi/design/style.css?v=2.0.18.1" media="all" />
<link rel="stylesheet" type="text/css" href="/plugins/FileUpload/design/fileupload.css?v=1.5.2" media="all" />
<link rel="stylesheet" type="text/css" href="/plugins/Voting/design/voting.css?v=1.1.1b" media="all" />
<!--[if gt IE 6]><link rel="stylesheet" type="text/css" href="/plugins/cleditor/design/jquery.cleditor.css?v=1.1" media="all" /><![endif]-->
<!--[if !IE]> --><link rel="stylesheet" type="text/css" href="/plugins/cleditor/design/jquery.cleditor.css?v=1.1" media="all" /><!-- <![endif]-->
<link rel="shortcut icon" href="/themes/geoloqi/design/favicon.png" type="image/x-icon" />
<link rel="canonical" href="http://community.geoloqi.com/discussion/125/using-ios-sdk-with-api-call-requiring-access-token-oauth/p1" />
<script src="/js/library/jquery.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/library/jquery.livequery.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/library/jquery.form.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/library/jquery.popup.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/library/jquery.gardenhandleajaxform.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/global.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/js/library/jquery.ui.packed.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/applications/vanilla/js/options.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/applications/vanilla/js/bookmark.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/applications/vanilla/js/discussion.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/applications/vanilla/js/autosave.js?v=2.0.18.1" type="text/javascript"></script>
<script src="/plugins/FileUpload/js/fileupload.js?v=1.5.2" type="text/javascript"></script>
<script src="/plugins/Voting/voting.js?v=1.1.1b" type="text/javascript"></script>
<!--[if gt IE 6]><script src="/plugins/cleditor/js/jquery.cleditor.min.js?v=1.1" type="text/javascript"></script><![endif]-->
<!--[if !IE]> --><script src="/plugins/cleditor/js/jquery.cleditor.min.js?v=1.1" type="text/javascript"></script><!-- <![endif]-->
<style type="text/css">
a.PreviewButton {
	display: none !important;
}
</style>
<script type="text/javascript">
	jQuery(document).ready(function($) {
		// Make sure the removal of autogrow does not break anything
		jQuery.fn.autogrow = function(o) { return; }
		// Attach the editor to comment boxes
		jQuery("#Form_Body").livequery(function() {
			var frm = $(this).parents("div.CommentForm");
			ed = jQuery(this).cleditor({width:"100%", height:"100%"})[0];
			this.editor = ed; // Support other plugins!
			jQuery(frm).bind("clearCommentForm", {editor:ed}, function(e) {
				frm.find("textarea").hide();
				e.data.editor.clear();
			});
		});
	});
</script>
<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-25750303-8']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();
</script>
  <link rel="pingback" href="http://pingback.me/geoloqi/xmlrpc" />
</head>
<body id="vanilla_discussion_comment" class="Vanilla Discussion comment ">
   <div id="Frame">
      <div id="Head">
         <div class="Menu">
            <h1><a class="Title" href="/"><span><img src="http://community.geoloqi.com/uploads/UCF5TIEJOT0K.png" alt="Geoloqi Community" /></span></a></h1>
            <ul id="Menu"><li class=" Highlight"><a href="/discussions">Discussions</a></li>
<li><a href="/irc">IRC</a></li>
<li class="NonTab"><a href="/entry/signin?Target=discussion%2Fcomment%2F374">Sign In</a></li>
</ul>            <div class="Search"><form method="get" action="/search">
<div>
<input type="text" id="Form_Search" name="Search" value="" class="InputBox" /><input type="submit" id="Form_Go" value="Go" class="Button" />
</div>
</form></div>
         </div>
      </div>
      <div id="Body">
         <div id="Content"><div class="Tabs HeadingTabs DiscussionTabs FirstPage">
   
   <ul>
      <li><a href="/categories/support" class="TabLink">Support</a></li>
   </ul>
   <div class="SubTab">using iOS SDK with API call requiring access token (OAuth)</div>
</div>
<ul class="DataList MessageList Discussion FirstPage">
   <li class="Item Comment FirstComment" id="Discussion_125">
   <div class="Comment">
      <div class="Meta">
         <span class="Votes"><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteUp SignInPopup"><i class="ArrowSprite SpriteUp" rel="nofollow"><i>Vote Up</i></i></a><span>0</span><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteDown SignInPopup"><i class="ArrowSprite SpriteDown" rel="nofollow"><i>Vote Down</i></i></a></span>         <span class="Author">
            <a href="/profile/379/20sKL1icp2vPSqxnX">20sKL1icp2vPSqxnX</a>         </span>
         <span class="DateCreated">
            <a href="/discussion/125/using-ios-sdk-with-api-call-requiring-access-token-oauth/p1" class="Permalink" name="Item_1" rel="nofollow">September 2012</a>         </span>
                  <div class="CommentInfo">
                     </div>
               </div>
      <div class="Message">
			<span style="font-family: Arial, Verdana;">There are several calls in the API that require passing in an access token. An example in the API docs shows this:</span><div><pre style="font-family: monospace, serif; font-size: 1em; word-wrap: break-word; overflow-x: auto; color: rgb(46, 46, 46); text-align: left; background-color: rgb(255, 255, 255);">$ curl https:<span class="sy0" style="color: rgb(0, 0, 0); font-weight: bold;">//</span>api.geoloqi.com<span class="sy0" style="color: rgb(0, 0, 0); font-weight: bold;">/</span><span class="nu0" style="color: rgb(0, 0, 0);">1</span><span class="sy0" style="color: rgb(0, 0, 0); font-weight: bold;">/</span>group<span class="sy0" style="color: rgb(0, 0, 0); font-weight: bold;">/</span>message<span class="sy0" style="color: rgb(0, 0, 0); font-weight: bold;">/</span>d6Qwh1eSy \<br><span class="re5" style="color: rgb(102, 0, 51);">-H</span> <span class="st0" style="color: rgb(255, 0, 0);">"Authorization: OAuth 152a5-2c91e9335da92345ef48f7bc45c17272a40abf52"</span> \<br><span class="re5" style="color: rgb(102, 0, 51);">-H</span> <span class="st0" style="color: rgb(255, 0, 0);">"Content-type: application/json"</span> \<br><span class="re5" style="color: rgb(102, 0, 51);">-d</span> <span class="st0" style="color: rgb(255, 0, 0);">'{"push": true, "text": "Hello everyone!"}'</span></pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);"><span style="font-family: Arial, Verdana;"><span style="white-space: normal;"><br></span></span></pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);"><span style="font-family: Arial, Verdana;"><span style="white-space: normal;">I'm attempting to translate this for use with the iOS SDK, and there aren't any examples of how to add the access token in the documentation. The closest I've gotten so far (thanks to some code in DinoDeals) is this:</span></span></pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);">// send a message to all the users in the group<span style="color: #000000">&nbsp; &nbsp; </span>NSMutableDictionary<span style="color: #000000"> *params = [[</span>NSMutableDictionary<span style="color: #000000"> </span><span style="color: #4a0083">alloc</span><span style="color: #000000">] </span><span style="color: #4a0083">init</span><span style="color: #000000">];</span><span style="color: #000000">&nbsp; &nbsp; [params </span>setObject<span style="color: #000000">:[</span><span style="color: #7f1bab">NSNumber</span><span style="color: #000000"> </span>numberWithBool<span style="color: #000000">:</span><span style="color: #cf00a0">true</span><span style="color: #000000">] </span>forKey<span style="color: #000000">:</span><span style="color: #e50000">@"push"</span><span style="color: #000000">];</span><span style="color: #000000">&nbsp; &nbsp; [params </span><span style="color: #4a0083">setObject</span><span style="color: #000000">:</span>@"Hello everyone!"<span style="color: #000000"> </span><span style="color: #4a0083">forKey</span><span style="color: #000000">:</span>@"text"<span style="color: #000000">];</span><br><span style="color: #000000">&nbsp; &nbsp; </span><span style="color: #7f1bab">NSMutableURLRequest</span><span style="color: #000000"> *request = [[[</span><span style="color: #3c8389">LQSession</span><span style="color: #000000"> </span>savedSession<span style="color: #000000">] </span>requestWithMethod<span style="color: #000000">:</span><span style="color: #e50000">@"POST"</span><span style="color: #000000"> </span>path<span style="color: #000000">:</span><span style="color: #e50000">@"/group/message/d6QwhleSy"</span><span style="color: #000000"> </span>payload<span style="color: #000000">:params] </span><span style="color: #4a0083">mutableCopy</span><span style="color: #000000">];</span><span style="color: #000000">&nbsp; &nbsp; [request </span>setValue<span style="color: #000000">:[</span><span style="color: #7f1bab">NSString</span><span style="color: #000000"> </span>stringWithFormat<span style="color: #000000">:</span><span style="color: #e50000">@"OAuth %@"</span><span style="color: #000000">, [</span><span style="color: #3c8389">LQSession</span><span style="color: #000000"> </span><span style="color: #215a5f">savedSession</span><span style="color: #000000">].</span><span style="color: #3c8389">accessToken</span><span style="color: #000000">] </span>forHTTPHeaderField<span style="color: #000000">:</span><span style="color: #e50000">@"Authorization"</span><span style="color: #000000">];</span>&nbsp; &nbsp; [[<span style="color: #3c8389">LQSession</span> <span style="color: #215a5f">savedSession</span>] <span style="color: #215a5f">runAPIRequest</span>:request <span style="color: #215a5f">completion</span>:^(<span style="color: #7f1bab">NSHTTPURLResponse</span> *response, <span style="color: #7f1bab">NSDictionary</span> *responseDictionary, <span style="color: #7f1bab">NSError</span> *error) {<br><span style="color: #000000">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #804623">NSLog</span><span style="color: #000000">(</span>@"Response to sending a message to the group: %@ error:%@"<span style="color: #000000">, responseDictionary, error);</span>&nbsp; &nbsp; }];</pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);"><span style="font-family: Arial;">-----------</span></pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);"><span style="font-family: Arial;">Is this a proper way to format this call? It seems right, but I'm getting a "You are not authorized..." response, so it's hard to tell. </span></pre><pre style="text-align: -webkit-auto; font-size: 1em; word-wrap: break-word; overflow-x: auto; background-color: rgb(255, 255, 255);"><span style="font-family: Arial;">thanks</span></pre></div>		</div>
         </div>
</li>
		<li>
			<div class="Tabs DiscussionTabs AnswerTabs">
			<strong>2 Comments</strong> sorted by 
				<ul>
					<li class="Active"><a href="http://community.geoloqi.com/discussion/comment/374?Sort=popular" rel="nofollow">Votes</a></li>
					<li><a href="http://community.geoloqi.com/discussion/comment/374?Sort=date" rel="nofollow">Date Added</a></li>
				</ul>			</div>
		</li>
		<li class="Item Comment Alt" id="Comment_374">
   <div class="Comment">
      <div class="Meta">
         <span class="Votes"><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteUp SignInPopup"><i class="ArrowSprite SpriteUp" rel="nofollow"><i>Vote Up</i></i></a><span>1</span><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteDown SignInPopup"><i class="ArrowSprite SpriteDown" rel="nofollow"><i>Vote Down</i></i></a></span>         <span class="Author">
            <a title="aaronpk" href="/profile/2/aaronpk" class="ProfileLink"><img src="http://community.geoloqi.com/uploads/userpics/504/nH4SPOJELL2SX.jpg" alt="aaronpk" class="ProfilePhotoMedium" /></a><a href="/profile/2/aaronpk">aaronpk</a>         </span>
         <span class="DateCreated">
            <a href="/discussion/comment/374#Comment_374" class="Permalink" name="Item_2" rel="nofollow">September 2012</a>         </span>
                  <div class="CommentInfo">
                     </div>
               </div>
      <div class="Message">
			<span style="font-family: Arial, Verdana; font-size: small;">Actually the SDK handles this automatically. Here is a simple example of making an API call with the access token:</span><div style="font-family: Arial, Verdana; font-size: 10pt; font-style: normal; font-variant: normal; font-weight: normal; line-height: normal;"><br></div><div><span style="font-family: Arial, Verdana; font-size: small;"><a rel="nofollow" href="https://github.com/geoloqi/Geoloqi-iPhone-SDK/blob/master/TrackerSample/TrackerSample/TrackerSampleViewController.m#L141">https://github.com/geoloqi/Geoloqi-iPhone-SDK/blob/master/TrackerSample/TrackerSample/TrackerSampleViewController.m#L141</a></span></div><div><span style="font-family: Arial, Verdana; font-size: small;"><br></span></div><div><span style="font-family: Arial, Verdana; font-size: small;">When you use the "requestWithMethod" and "runAPIRequest" methods of LQSession, the session class takes care of all the authentication and JSON parsing.</span></div><div><span style="font-family: Arial, Verdana; font-size: small;"><br></span></div><div><span style="font-family: Courier New; font-size: small;">NSURLRequest *req = [[LQSession savedSession] requestWithMethod:@"GET" path:@"/location/context" payload:nil];</span></div><div><span style="font-family: Courier New; font-size: small;">[[LQSession savedSession] runAPIRequest:req completion:^(NSHTTPURLResponse *response, NSDictionary *responseDictionary, NSError *error) {</span></div><div><span style="font-family: Courier New; font-size: small;">&nbsp; // do stuff</span></div><div><span style="font-family: Courier New; font-size: small;">}];</span></div>		</div>
         </div>
</li>
<li class="Item Comment" id="Comment_378">
   <div class="Comment">
      <div class="Meta">
         <span class="Votes"><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteUp SignInPopup"><i class="ArrowSprite SpriteUp" rel="nofollow"><i>Vote Up</i></i></a><span>0</span><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="VoteDown SignInPopup"><i class="ArrowSprite SpriteDown" rel="nofollow"><i>Vote Down</i></i></a></span>         <span class="Author">
            <a href="/profile/379/20sKL1icp2vPSqxnX">20sKL1icp2vPSqxnX</a>         </span>
         <span class="DateCreated">
            <a href="/discussion/comment/378#Comment_378" class="Permalink" name="Item_3" rel="nofollow">September 2012</a>         </span>
                  <div class="CommentInfo">
                     </div>
               </div>
      <div class="Message">
			Roger that! It's all&nbsp;becoming more clear now.<div>Thanks for helping us all wade through the docs and samples.&nbsp;</div>		</div>
         </div>
</li>
</ul>
   <div class="Foot">
      <a href="/entry/signin?Target=discussion%2Fcomment%2F374%3Fpost%23Form_Body" class="TabLink">Add a Comment</a> 
   </div>
   </div>
         <div id="Panel"><div class="Box GuestBox">
   <h4>Howdy, Stranger!</h4>
   <p>It looks like you're new here. If you want to get involved, click one of these buttons!</p>
      
   <div class="P"><a href="/entry/signin?Target=discussion%2Fcomment%2F374" class="Button">Sign In</a> <a href="/entry/register?Target=discussion%2Fcomment%2F374" class="Button ApplyButton">Apply for Membership</a></div>   </div><div class="Box BoxCategories">
   <h4><a href="/categories/all">Categories</a></h4>
   <ul class="PanelInfo PanelCategories">
      <li><span><strong><a href="/discussions">All Discussions</a></strong><span class="Count">340</span></span></li>
<li class="Depth1"><strong><a href="/categories/bug-reports">Bug Reports</a></strong><span class="Count">89</span></li>
<li class="Depth1"><strong><a href="/categories/feature-requests">Feature Requests</a></strong><span class="Count">7</span></li>
<li class="Depth1 Active"><strong><a href="/categories/support">Support</a></strong><span class="Count">88</span></li>
<li class="Depth1"><strong><a href="/categories/layers">Layers</a></strong><span class="Count">132</span></li>
<li class="Depth1"><strong><a href="/categories/general">General</a></strong><span class="Count">24</span></li>
   </ul>
</div>
         <div class="Box">
         <h4>In this Discussion</h4>
         <ul class="PanelInfo">
                     <li>
               <strong><a href="/profile/379/20sKL1icp2vPSqxnX" class="UserLink">20sKL1icp2vPSqxnX</a></strong>
               September 2012            </li>
                        <li>
               <strong><a href="/profile/2/aaronpk" class="UserLink">aaronpk</a></strong>
               September 2012            </li>
                     </ul>
      </div>
      </div>
      </div>
      <div id="Foot">
			<!-- Various definitions for Javascript //-->
<div id="Definitions" style="display: none;">
<input type="hidden" id="ImageResized" value="This image has been resized to fit in the page. Click to enlarge." />
<input type="hidden" id="DiscussionID" value="125" />
<input type="hidden" id="apcavailable" value="" />
<input type="hidden" id="uploaderuniq" value="54f249f05b6e5" />
<input type="hidden" id="maxuploadsize" value="31457280" />
<input type="hidden" id="AnalyticsTask" value="tick" />
<input type="hidden" id="LastCommentID" value="378" />
<input type="hidden" id="Vanilla_Comments_AutoRefresh" value="0" />
<input type="hidden" id="TransportError" value="A fatal error occurred while processing the request.&lt;br /&gt;The server returned the following response: %s" />
<input type="hidden" id="TransientKey" value="NVHLGEAPPIR6" />
<input type="hidden" id="WebRoot" value="http://community.geoloqi.com/" />
<input type="hidden" id="UrlFormat" value="/{Path}" />
<input type="hidden" id="Path" value="discussion/comment/374" />
<input type="hidden" id="SignedIn" value="0" />
<input type="hidden" id="ConfirmHeading" value="Confirm" />
<input type="hidden" id="ConfirmText" value="Are you sure you want to do that?" />
<input type="hidden" id="Okay" value="Okay" />
<input type="hidden" id="Cancel" value="Cancel" />
<input type="hidden" id="Search" value="Search" />
</div><div><a href="http://vanillaforums.org">Powered by Vanilla</a></div>		</div>
   </div>
	</body>
</html>
